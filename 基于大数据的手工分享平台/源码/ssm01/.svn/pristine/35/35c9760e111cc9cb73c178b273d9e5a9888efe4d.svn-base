<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="ssm.mapper.mineMapper.CustomerMapper" >
  <resultMap id="BaseResultMap" type="ssm.pojo.Mine.Customer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 28 10:49:02 CST 2019.
    -->
    <id column="u_id" property="u_id" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="headPicPath" property="headPicPath" jdbcType="VARCHAR" />
    <result column="phonenumber" property="phonenumber" jdbcType="VARCHAR" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="VARCHAR" />
    <result column="location" property="location" jdbcType="VARCHAR" />
    <result column="signature" property="signature" jdbcType="VARCHAR" />
    <result column="order_consigneeAddress" property="order_consigneeAddress" jdbcType="VARCHAR" />
    <result column="cancellationCount" property="cancellationCount" />
  </resultMap>
 
 
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 28 10:49:02 CST 2019.
    -->
    u_id, name, headPicPath , phonenumber, password, address, gender, location, signature
  </sql>
  
  <select id="selectByUsernameAndPassword" resultMap="BaseResultMap" parameterType="ssm.pojo.Mine.Customer">
  		select * from customer where phonenumber=#{phonenumber} and password=#{password}
  </select>
  
  <select id="selectFollowDetail" parameterType="java.lang.String" resultMap="BaseResultMap" >
  		select * from customer,follow_fan 
  		where customer.u_id = follow_fan.u_id 
  		and follow_fan.fan_id=#{u_id}
  </select>
   <select id="selectFanDetail" parameterType="java.lang.String" resultMap="BaseResultMap" >
  		select * from customer,follow_fan 
  		where customer.u_id = follow_fan.fan_id 
  		and follow_fan.u_id=#{u_id}
  </select>
  
  <update id="updateCustomer" parameterType="ssm.pojo.Mine.Customer">
  UPDATE 
  `manual_app`.`customer` 
  SET
    u_id=#{u_id}
  <if test="name != null">
  	,`name` = #{name}
  </if>
   <if test="headPicPath != null">
  	,`headPicPath` = #{headPicPath}
  </if>
  <if test="phonenumber != null">
  	 ,`phonenumber` = #{phonenumber}
  </if>
  <if test="password != null">
  	`password` = #{password}
  </if>
  <if test="address != null">
  	,`address` = #{address}
  </if>
  <if test="gender != null">
  	 ,`gender` = #{gender}
  </if>
  <if test="location != null">
  	 ,`location` = #{location}
  </if>
  <if test="signature != null">
  	  ,`signature` = #{signature} 
  </if>

WHERE `u_id` = #{u_id} ;
  </update>
 
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.String" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 28 10:49:02 CST 2019.
    -->
    select 
    <include refid="Base_Column_List" />
    from customer
    where u_id = #{uId,jdbcType=VARCHAR}
  </select>
  <select id="findDynamicCount" parameterType="java.lang.String" resultType="java.lang.Integer">
  	select count(*) from dynamic where u_id=#{u_id}
  </select>
  <select id="findfollowCount" parameterType="java.lang.String" resultType="java.lang.Integer">
 	 select count(*) from follow_fan where fan_id=#{u_id}
  </select>
  <select id="findfanCount" parameterType="java.lang.String" resultType="java.lang.Integer">
 	 select count(*) from follow_fan where u_id=#{u_id}	
  </select>
 
 <!-- 这里开始时后台  -->
  <select id="selectallCustomer" resultMap="BaseResultMap">
  		select * from customer
  </select>
  <select id="selectByU_id" parameterType="java.lang.String" resultMap="BaseResultMap">
  		select * from customer where u_id = #{u_id}
  </select>
  <update id="editCustomer" parameterType="ssm.pojo.Mine.Customer">
  		
	UPDATE 
	  `manual_app`.`customer` 
	SET
	  `name` = #{name},
	  `headPicPath` = #{headPicPath},
	  `phonenumber` = #{phonenumber},
	  `password` = #{password},
	  `address` = #{address},
	  `gender` = #{gender},
	  `location` = #{location},
	  `signature` = #{signature} 
	WHERE `u_id` = #{u_id} ;
  </update>
  <delete id="deleteCustomer" parameterType="java.lang.String">
  		delete from customer where u_id=#{u_id}
  </delete>
  <insert id="addCustomer" parameterType="ssm.pojo.Mine.Customer">
	  INSERT INTO `manual_app`.`customer` (
	  `u_id`,
	  `name`,
	  `headPicPath`,
	  `phonenumber`,
	  `password`,
	  `address`,
	  `gender`,
	  `location`,
	  `signature`
	) 
	VALUES
	  (
	    #{u_id},
	    #{name},
	    #{headPicPath},
	    #{phonenumber},
	    #{password},
	    #{address},
	    #{gender},
	    #{location},
	    #{signature}
	  ) ;
  </insert>
  
  <select id="SelectHighRisk" resultMap="BaseResultMap">
		SELECT * FROM customer WHERE (cancellationCount > 0) ORDER BY cancellationCount DESC LIMIT 0,50
	</select>
 
 	<!-- 更新用户退款次数 -->
 	<update id="updataCustomerCancellationCount" parameterType="ssm.pojo.Mine.Customer">
		UPDATE customer SET cancellationCount = #{cancellationCount} WHERE u_id = #{u_id}
	</update>
	<!-- 根据id查找用户 -->
	<select id="findCustomerById" parameterType="String" resultType="ssm.pojo.Mine.Customer">
		SELECT * FROM customer WHERE u_id = #{u_id}
	</select>
	
</mapper>